{{- /*
SPDX-FileCopyrightText: Pachyderm, Inc. <info@pachyderm.com>
SPDX-License-Identifier: Apache-2.0
*/ -}}
{{- /* Sanity check to ensure .create set if .crt or .key set */ -}}
{{- if and (not .Values.pachd.externalService.tls.newSecret.create) .Values.pachd.externalService.tls.newSecret.crt }}
  {{ fail "Must set pachd.newSecret.create to true when specifying pachd.externalService.tls.newSecret.crt "}}
{{ end -}}
{{- if and (not .Values.pachd.externalService.tls.newSecret.create) .Values.pachd.externalService.tls.newSecret.key }}
  {{ fail "Must set tls.newSecret.create to true when specifying pachd.externalService.tls.newSecret.key "}}
{{ end -}}
{{- if and .Values.pachd.enabled .Values.pachd.externalService.tls.enabled .Values.pachd.externalService.tls.newSecret.create }}
apiVersion: "v1"
data:
  tls.crt: {{ required "When enabling pachd.externalService.tls.newSecret.create, you must specify pachd.externalService.tls.newSecret.crt" .Values.pachd.externalService.tls.newSecret.crt | b64enc | quote }}
  tls.key: {{ required "When enabling pachd.externalService.tls.newSecret.create, you must specify pachd.externalService.tls.newSecret.key" .Values.pachd.externalService.tls.newSecret.key | b64enc | quote }}
kind: Secret
metadata:
  labels:
    app: "pachyderm"
    suite: "pachyderm"
  name: {{ required "When pachd.externalService.tls.enabled you must specify .Values.pachd.externalService.tls.secretName" .Values.pachd.externalService.tls.secretName | quote }}
{{ end -}}
